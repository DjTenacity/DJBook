## python中脚本执行和命令行执行的区别

首先我们先看一下下面的代码：

![img](https://ss1.baidu.com/6ONXsjip0QIZ8tyhnq/it/u=3574901863,1186919481&fm=173&app=25&f=JPEG?w=549&h=288&s=6110E43B1B425C4908C410D30000F0B2)

我们可以看出，变量a和变量b指向同一内存地址，官方文档对这个问题的解释如下：

出于对性能的考虑，Python内部把-5~256之间的整数对象缓存了起来，在Python的整个生命周期内，任何需要引用这些整数对象的地方，都不再重新创建新的对象。不在此范围内的对象，则会重新创建。于是笔者有了以下的测试：

![img](https://ss1.baidu.com/6ONXsjip0QIZ8tyhnq/it/u=2568162670,2669741924&fm=173&app=25&f=JPEG?w=481&h=294&s=E418E53A194E454D0AE414D2000080B2)

看到结果后不禁惊呼，什么鬼，我们定义的变量值为257，按照 文档的说法，在声明变量b的时候，应该重新开辟一个内存地址才对啊。第一时间笔者想到的是难道python版本的问题，不同版本处理机制难道不一样，翻找果很多资料之后才发现这个问题和版本无关，是python执行方式的问题，我们看一下同样的代码在python命令下执行的效果：

![img](https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=1868287649,3153067131&fm=173&app=25&f=JPEG?w=334&h=213&s=2FA674234D425E4F5AFDA5DA0000C0B3) 

这就对了，在命令行下测试代码是完全符合官方文档所说，那么为什么脚本执行时测试的效果完全不同呢？

为了弄清楚这个问题，我们有必要先理解下代码块的概念。在命令行模式下，每一行都是一个单独的代码块，而在脚本中，整个文件内所有代码（我们此处没有使用函数等）都是一个代码块。Python内部为了将性能进一步的提高，凡是在一个代码块中创建的整数对象，如果该代码块中存在一个值与其相同的对象，那么就会直接引用，没有相同的值时才会创建一个新的对象。Python出于对性能的考虑，但凡是不可变对象，在同一个代码块中的对象，只有是值相同的对象，就不会重复创建，而是直接引用已经存在的对象。因此，不仅是整数对象，还有字符串对象也遵循同样的原则。所以在脚本中测试才会出现问题。

总结：

1、python中小整形对象（-5~256）处理时为了提升效率会在加载进内存时进行缓存，这一点很类似与java中的常量池

2、python在执行脚本文件时，出于性能考虑会对相同值的不可变对象采取引用处理，而不会重新创建。

3、测试python的代码时，建议用命令行进行测试，避免出现变差。